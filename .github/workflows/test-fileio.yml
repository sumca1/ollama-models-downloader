name: Test Upload (File.io - Anonymous)

on:
  workflow_dispatch:
    inputs:
      test_message:
        description: 'Test message'
        required: false
        default: 'Testing file.io'

jobs:
  test-fileio:
    runs-on: ubuntu-latest
    
    steps:
      - name: Create test file
        run: |
          echo "ðŸ§ª Creating test file..."
          mkdir -p test-upload
          cat > test-upload/test-fileio.txt << EOF
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘         Test Upload via File.io (Anonymous)            â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘  Method: File.io                                       â•‘
          â•‘  Date: $(date -u +"%Y-%m-%d %H:%M:%S UTC")            â•‘
          â•‘  Message: ${{ github.event.inputs.test_message }}     â•‘
          â•‘                                                        â•‘
          â•‘  ðŸ’¡ No account needed!                                 â•‘
          â•‘  âš ï¸  File deleted after FIRST download!                â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          EOF
          cat test-upload/test-fileio.txt

      - name: Upload to File.io
        run: |
          echo "ðŸ“¤ Uploading to file.io..."
          
          RESPONSE=$(curl -F "file=@test-upload/test-fileio.txt" https://file.io)
          
          echo "Response: $RESPONSE"
          
          SUCCESS=$(echo $RESPONSE | grep -o '"success":\s*true')
          DOWNLOAD_LINK=$(echo $RESPONSE | grep -o '"link":"[^"]*"' | cut -d'"' -f4)
          
          if [ ! -z "$DOWNLOAD_LINK" ] && [ ! -z "$SUCCESS" ]; then
            echo ""
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘             FILE.IO UPLOAD SUCCESS!                    â•‘"
            echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
            echo "â•‘  âœ… No account needed!                                 â•‘"
            echo "â•‘  âœ… Anonymous upload!                                  â•‘"
            echo "â•‘  âš ï¸  File auto-deletes after FIRST download!           â•‘"
            echo "â•‘                                                        â•‘"
            echo "â•‘  ðŸ“¥ Download link (use once!):                         â•‘"
            echo "â•‘     $DOWNLOAD_LINK"
            echo "â•‘                                                        â•‘"
            echo "â•‘  âš ï¸  Don't click twice - file will be gone!            â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          else
            echo "âŒ Upload failed or was blocked"
            echo "Full response: $RESPONSE"
          fi

      - name: Summary
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… File.io test completed!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Pros:"
          echo "  âœ… No account needed!"
          echo "  âœ… Accessible in NetFree (we tested)"
          echo "  âœ… Up to 2GB free"
          echo "  âœ… Simple API"
          echo ""
          echo "Cons:"
          echo "  âš ï¸ File deleted after FIRST download"
          echo "  âš ï¸ No way to re-download if failed"
          echo "  âš ï¸ Not suitable for multiple downloads"
